# ğŸ›ï¸ ç”µå•†ç»„ä»¶è£…ä¿®ç³»ç»Ÿ - è¯¦ç»†è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

1. [æ•´ä½“æ¶æ„è®¾è®¡](#æ•´ä½“æ¶æ„è®¾è®¡)
2. [Cç«¯ç»„ä»¶åŒ–ç³»ç»Ÿï¼ˆSSRï¼‰](#cç«¯ç»„ä»¶åŒ–ç³»ç»Ÿssr)
3. [ç®¡ç†åå°æ‹–æ‹½ç¼–è¾‘ç³»ç»Ÿï¼ˆCSR SPAï¼‰](#ç®¡ç†åå°æ‹–æ‹½ç¼–è¾‘ç³»ç»Ÿcsr-spa)
4. [ç»„ä»¶é…ç½®ç³»ç»Ÿ](#ç»„ä»¶é…ç½®ç³»ç»Ÿ)
5. [ç»„ä»¶æ¸²æŸ“å¼•æ“](#ç»„ä»¶æ¸²æŸ“å¼•æ“)
6. [æ‹–æ‹½äº¤äº’ç³»ç»Ÿ](#æ‹–æ‹½äº¤äº’ç³»ç»Ÿ)
7. [ç»„ä»¶å±æ€§ç¼–è¾‘å™¨](#ç»„ä»¶å±æ€§ç¼–è¾‘å™¨)
8. [é¡µé¢ä¿å­˜å’Œå‘å¸ƒ](#é¡µé¢ä¿å­˜å’Œå‘å¸ƒ)
9. [ç»„ä»¶åº“è®¾è®¡](#ç»„ä»¶åº“è®¾è®¡)
10. [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
11. [æŠ€æœ¯æ ˆé€‰æ‹©](#æŠ€æœ¯æ ˆé€‰æ‹©)
12. [æ–‡ä»¶ç»“æ„](#æ–‡ä»¶ç»“æ„)

---

## ğŸ¯ æ•´ä½“æ¶æ„è®¾è®¡

### 1.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Nuxt 4 åº”ç”¨                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Cç«¯é¡µé¢ (SSR)   â”‚    â”‚   ç®¡ç†åå° (CSR SPA)              â”‚  â”‚
â”‚  â”‚                  â”‚    â”‚                                  â”‚  â”‚
â”‚  â”‚  - é¦–é¡µ          â”‚    â”‚  - ç»„ä»¶åº“                       â”‚  â”‚
â”‚  â”‚  - æ´»åŠ¨é¡µ        â”‚    â”‚  - ç”»å¸ƒåŒºåŸŸ                     â”‚  â”‚
â”‚  â”‚  - å•†å“é¡µ        â”‚    â”‚  - å±æ€§ç¼–è¾‘å™¨                   â”‚  â”‚
â”‚  â”‚                  â”‚    â”‚  - é¡µé¢é…ç½®                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                               â”‚                      â”‚
â”‚           â–¼                               â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ç»„ä»¶æ¸²æŸ“å¼•æ“ (Component Render Engine)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ç»„ä»¶é…ç½®ç³»ç»Ÿ (Component Config System)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ç»„ä»¶åº“ (Component Library)                   â”‚   â”‚
â”‚  â”‚  - è½®æ’­å›¾ç»„ä»¶                                              â”‚   â”‚
â”‚  â”‚  - å•†å“åˆ—è¡¨ç»„ä»¶                                            â”‚   â”‚
â”‚  â”‚  - å¯¼èˆªæ ç»„ä»¶                                              â”‚   â”‚
â”‚  â”‚  - å¹¿å‘Šä½ç»„ä»¶                                              â”‚   â”‚
â”‚  â”‚  - æ´»åŠ¨å¡ç‰‡ç»„ä»¶                                            â”‚   â”‚
â”‚  â”‚  - è‡ªå®šä¹‰HTMLç»„ä»¶                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - /api/pages (é¡µé¢ CRUD)                                       â”‚
â”‚  - /api/components (ç»„ä»¶é…ç½®)                                   â”‚
â”‚  - /api/component-library (ç»„ä»¶åº“ç®¡ç†)                          â”‚
â”‚  - /api/templates (æ¨¡æ¿ç®¡ç†)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ç»„ä»¶åŒ–è®¾è®¡**
   - æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ç‹¬ç«‹çš„ Vue ç»„ä»¶
   - ç»„ä»¶æ”¯æŒé…ç½®åŒ–ï¼ˆpropsï¼‰
   - ç»„ä»¶æ”¯æŒè‡ªå®šä¹‰æ ·å¼

2. **é…ç½®é©±åŠ¨**
   - é¡µé¢ç”± JSON é…ç½®é©±åŠ¨
   - é…ç½®åŒ…å«ç»„ä»¶åˆ—è¡¨ã€é¡ºåºã€å±æ€§
   - é…ç½®æ”¯æŒç‰ˆæœ¬ç®¡ç†

3. **æ¸²æŸ“å¼•æ“**
   - ç»Ÿä¸€çš„ç»„ä»¶æ¸²æŸ“å¼•æ“
   - æ”¯æŒ SSR å’Œ CSR æ¸²æŸ“
   - æ”¯æŒåŠ¨æ€ç»„ä»¶åŠ è½½

4. **æ‹–æ‹½ç¼–è¾‘**
   - å¯è§†åŒ–æ‹–æ‹½ç•Œé¢
   - å®æ—¶é¢„è§ˆ
   - æ‰€è§å³æ‰€å¾—

---

## ğŸ–¥ï¸ Cç«¯ç»„ä»¶åŒ–ç³»ç»Ÿï¼ˆSSRï¼‰

### 2.1 è®¾è®¡ç›®æ ‡

- âœ… æ”¯æŒ SSR æ¸²æŸ“ï¼Œæå‡ SEO å’Œé¦–å±åŠ è½½é€Ÿåº¦
- âœ… æ”¯æŒåŠ¨æ€ç»„ä»¶é…ç½®
- âœ… é«˜æ€§èƒ½ï¼Œæ”¯æŒå¤§é‡ç»„ä»¶
- âœ… å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå¤šç«¯é€‚é…
- âœ… ç¼“å­˜ä¼˜åŒ–ï¼Œå‡å°‘é‡å¤æ¸²æŸ“

### 2.2 å®ç°æ–¹æ¡ˆ

#### 2.2.1 é¡µé¢è·¯ç”±è®¾è®¡

```typescript
// app/pages/[pageSlug].vue
// åŠ¨æ€è·¯ç”±ï¼Œæ ¹æ®é¡µé¢ slug åŠ è½½é…ç½®

// ç¤ºä¾‹ï¼š
// - /home â†’ é¦–é¡µé…ç½®
// - /sale/new-year â†’ æ–°å¹´æ´»åŠ¨é¡µ
// - /product/123 â†’ å•†å“è¯¦æƒ…é¡µï¼ˆæ··åˆæ¨¡å¼ï¼‰
```

#### 2.2.2 é¡µé¢ç»„ä»¶ç»“æ„

```vue
<template>
  <div class="page-container">
    <component-renderer :components="pageConfig.components" />
  </div>
</template>

<script setup lang="ts">
import type { PageConfig, ComponentConfig } from '~/types/component-builder'

const route = useRoute()
const pageSlug = route.params.pageSlug as string

// SSR é¢„å–é¡µé¢é…ç½®
const { data: pageConfig } = await useFetch<PageConfig>(
  `/api/pages/${pageSlug}`,
  {
    server: true,
    transform: (response) => response.data
  }
)
</script>
```

#### 2.2.3 ç»„ä»¶æ¸²æŸ“å™¨

```vue
<!-- app/components/ComponentRenderer.vue -->
<template>
  <div class="component-renderer">
    <component
      v-for="component in components"
      :key="component.id"
      :is="getComponent(component.type)"
      v-bind="component.props"
      :component-config="component"
    />
  </div>
</template>

<script setup lang="ts">
import type { ComponentConfig } from '~/types/component-builder'

const props = defineProps<{
  components: ComponentConfig[]
}>()

// ç»„ä»¶æ˜ å°„è¡¨
const componentMap = {
  'carousel': () => import('~/components/builder/Carousel.vue'),
  'product-list': () => import('~/components/builder/ProductList.vue'),
  'navigation': () => import('~/components/builder/Navigation.vue'),
  'banner': () => import('~/components/builder/Banner.vue'),
  'activity-card': () => import('~/components/builder/ActivityCard.vue'),
  'custom-html': () => import('~/components/builder/CustomHtml.vue'),
  'product-card': () => import('~/components/builder/ProductCard.vue'),
  'tab-nav': () => import('~/components/builder/TabNav.vue'),
  'footer': () => import('~/components/builder/Footer.vue')
}

// åŠ¨æ€åŠ è½½ç»„ä»¶
const getComponent = async (type: string) => {
  const loader = componentMap[type]
  if (!loader) {
    console.warn(`Component type "${type}" not found`)
    return () => null
  }
  return (await loader()).default
}
</script>
```

#### 2.2.4 ç¼“å­˜ç­–ç•¥

```typescript
// ä½¿ç”¨ Nuxt çš„ç¼“å­˜æœºåˆ¶
const { data: pageConfig } = await useFetch<PageConfig>(
  `/api/pages/${pageSlug}`,
  {
    server: true,
    cache: {
      maxAge: 60 * 60, // ç¼“å­˜ 1 å°æ—¶
      swr: true // åå°é‡æ–°éªŒè¯
    }
  }
)
```

---

## ğŸ¨ ç®¡ç†åå°æ‹–æ‹½ç¼–è¾‘ç³»ç»Ÿï¼ˆCSR SPAï¼‰

### 3.1 è®¾è®¡ç›®æ ‡

- âœ… çº¯ CSR æ¸²æŸ“ï¼Œæä¾›æµç•…çš„äº¤äº’ä½“éªŒ
- âœ… æ‹–æ‹½å¼ç»„ä»¶ç¼–è¾‘
- âœ… å®æ—¶é¢„è§ˆ
- âœ… ç»„ä»¶å±æ€§å¯è§†åŒ–ç¼–è¾‘
- âœ… æ”¯æŒæ’¤é”€/é‡åš
- âœ… æ”¯æŒæ¨¡æ¿ä¿å­˜å’Œå¤ç”¨

### 3.2 å®ç°æ–¹æ¡ˆ

#### 3.2.1 é¡µé¢å¸ƒå±€

```vue
<!-- app/pages/admin/builder.vue -->
<template>
  <div class="builder-container">
    <!-- å·¦ä¾§ï¼šç»„ä»¶åº“ -->
    <component-library @drag-start="onDragStart" />
    
    <!-- ä¸­é—´ï¼šç”»å¸ƒåŒºåŸŸ -->
    <canvas-area 
      :components="pageConfig.components" 
      @drop="onDrop"
      @component-select="onComponentSelect"
      @component-move="onComponentMove"
      @component-delete="onComponentDelete"
    />
    
    <!-- å³ä¾§ï¼šå±æ€§ç¼–è¾‘å™¨ -->
    <property-editor 
      v-if="selectedComponent"
      :component="selectedComponent"
      @update="onPropertyUpdate"
    />
    
    <!-- é¡¶éƒ¨ï¼šå·¥å…·æ  -->
    <toolbar 
      :page-config="pageConfig"
      @save="onSave"
      @publish="onPublish"
      @undo="onUndo"
      @redo="onRedo"
      @preview="onPreview"
    />
  </div>
</template>

<script setup lang="ts">
// é¡µé¢é…ç½®çŠ¶æ€
const pageConfig = ref<PageConfig>({
  id: '',
  name: '',
  slug: '',
  components: [],
  createdAt: new Date(),
  updatedAt: new Date()
})

// é€‰ä¸­çš„ç»„ä»¶
const selectedComponent = ref<ComponentConfig | null>(null)

// æ‹–æ‹½çŠ¶æ€
const dragState = ref<{
  componentType: string
  componentProps: Record<string, any>
} | null>(null)

// å†å²è®°å½•ï¼ˆç”¨äºæ’¤é”€/é‡åšï¼‰
const history = ref<PageConfig[]>([])
const historyIndex = ref(-1)

// æ–¹æ³•å®ç°
const onDragStart = (componentType: string, props: Record<string, any>) => {
  dragState.value = { componentType, componentProps: props }
}

const onDrop = (position: number) => {
  if (!dragState.value) return
  
  const newComponent: ComponentConfig = {
    id: `component-${Date.now()}`,
    type: dragState.value.componentType,
    props: { ...dragState.value.componentProps },
    position: position,
    createdAt: new Date()
  }
  
  pageConfig.value.components.splice(position, 0, newComponent)
  saveToHistory()
}

const onComponentSelect = (component: ComponentConfig) => {
  selectedComponent.value = component
}

const onComponentMove = (fromIndex: number, toIndex: number) => {
  const component = pageConfig.value.components.splice(fromIndex, 1)[0]
  pageConfig.value.components.splice(toIndex, 0, component)
  saveToHistory()
}

const onComponentDelete = (componentId: string) => {
  const index = pageConfig.value.components.findIndex(c => c.id === componentId)
  if (index !== -1) {
    pageConfig.value.components.splice(index, 1)
    saveToHistory()
  }
}

const onPropertyUpdate = (componentId: string, properties: Record<string, any>) => {
  const component = pageConfig.value.components.find(c => c.id === componentId)
  if (component) {
    component.props = { ...component.props, ...properties }
    saveToHistory()
  }
}

const saveToHistory = () => {
  // ä¿å­˜å½“å‰é…ç½®åˆ°å†å²è®°å½•
  const configCopy = JSON.parse(JSON.stringify(pageConfig.value))
  history.value = history.value.slice(0, historyIndex.value + 1)
  history.value.push(configCopy)
  historyIndex.value = history.value.length - 1
}

const onUndo = () => {
  if (historyIndex.value > 0) {
    historyIndex.value--
    pageConfig.value = JSON.parse(JSON.stringify(history.value[historyIndex.value]))
  }
}

const onRedo = () => {
  if (historyIndex.value < history.value.length - 1) {
    historyIndex.value++
    pageConfig.value = JSON.parse(JSON.stringify(history.value[historyIndex.value]))
  }
}

const onSave = async () => {
  await $fetch('/api/pages', {
    method: 'POST',
    body: pageConfig.value
  })
}

const onPublish = async () => {
  await $fetch('/api/pages/publish', {
    method: 'POST',
    body: { pageId: pageConfig.value.id }
  })
}
</script>
```

#### 3.2.2 ç»„ä»¶åº“ç»„ä»¶

```vue
<!-- app/components/admin/ComponentLibrary.vue -->
<template>
  <div class="component-library">
    <h3>ç»„ä»¶åº“</h3>
    <div class="component-list">
      <div
        v-for="component in components"
        :key="component.type"
        class="component-item"
        draggable="true"
        @dragstart="onDragStart(component)"
      >
        <component-preview :component="component" />
        <span>{{ component.name }}</span>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import type { ComponentDefinition } from '~/types/component-builder'

const emit = defineEmits<{
  (e: 'drag-start', componentType: string, props: Record<string, any>): void
}>()

// å¯ç”¨ç»„ä»¶åˆ—è¡¨
const components: ComponentDefinition[] = [
  {
    type: 'carousel',
    name: 'è½®æ’­å›¾',
    icon: 'ğŸ ',
    description: 'å›¾ç‰‡è½®æ’­ç»„ä»¶',
    defaultProps: {
      images: [],
      autoplay: true,
      interval: 3000,
      showIndicators: true
    }
  },
  {
    type: 'product-list',
    name: 'å•†å“åˆ—è¡¨',
    icon: 'ğŸ“¦',
    description: 'å•†å“å±•ç¤ºåˆ—è¡¨',
    defaultProps: {
      category: 'all',
      limit: 8,
      layout: 'grid',
      showPrice: true,
      showDiscount: true
    }
  },
  {
    type: 'navigation',
    name: 'å¯¼èˆªæ ',
    icon: 'ğŸ§­',
    description: 'é¡¶éƒ¨å¯¼èˆªæ ',
    defaultProps: {
      menus: [],
      backgroundColor: '#ffffff',
      textColor: '#333333'
    }
  },
  {
    type: 'banner',
    name: 'å¹¿å‘Šä½',
    icon: 'ğŸ“¢',
    description: 'å¹¿å‘Šæ¨ªå¹…',
    defaultProps: {
      image: '',
      link: '',
      title: '',
      subtitle: ''
    }
  },
  {
    type: 'activity-card',
    name: 'æ´»åŠ¨å¡ç‰‡',
    icon: 'ğŸ‰',
    description: 'æ´»åŠ¨å±•ç¤ºå¡ç‰‡',
    defaultProps: {
      title: '',
      subtitle: '',
      image: '',
      startTime: '',
      endTime: '',
      buttonText: 'ç«‹å³å‚ä¸',
      buttonLink: ''
    }
  },
  {
    type: 'custom-html',
    name: 'è‡ªå®šä¹‰HTML',
    icon: 'ğŸ’»',
    description: 'è‡ªå®šä¹‰HTMLå†…å®¹',
    defaultProps: {
      html: '',
      css: ''
    }
  },
  {
    type: 'product-card',
    name: 'å•†å“å¡ç‰‡',
    icon: 'ğŸ·ï¸',
    description: 'å•ä¸ªå•†å“å¡ç‰‡',
    defaultProps: {
      productId: '',
      showPrice: true,
      showDiscount: true,
      showAddToCart: true
    }
  },
  {
    type: 'tab-nav',
    name: 'æ ‡ç­¾å¯¼èˆª',
    icon: 'ğŸ“‘',
    description: 'æ ‡ç­¾é¡µå¯¼èˆª',
    defaultProps: {
      tabs: [],
      activeTab: 0
    }
  },
  {
    type: 'footer',
    name: 'é¡µè„š',
    icon: 'ğŸ¦¶',
    description: 'é¡µé¢åº•éƒ¨ä¿¡æ¯',
    defaultProps: {
      links: [],
      copyright: '',
      socialLinks: []
    }
  }
]

const onDragStart = (component: ComponentDefinition, event: DragEvent) => {
  if (event.dataTransfer) {
    event.dataTransfer.setData('componentType', component.type)
    event.dataTransfer.setData('componentProps', JSON.stringify(component.defaultProps))
  }
  emit('drag-start', component.type, component.defaultProps)
}
</script>
```

#### 3.2.3 ç”»å¸ƒåŒºåŸŸç»„ä»¶

```vue
<!-- app/components/admin/CanvasArea.vue -->
<template>
  <div class="canvas-area" @dragover.prevent @drop="onDrop">
    <div
      v-for="(component, index) in components"
      :key="component.id"
      class="canvas-component"
      :class="{ selected: selectedId === component.id }"
      @click="onSelect(component)"
      @dragstart="onDragStart(component, index)"
      @dragover.prevent="onDragOver($event, index)"
      @drop="onDropComponent($event, index)"
      draggable="true"
    >
      <component-renderer :components="[component]" />
      <div class="component-handle">
        <span class="drag-icon">â‹®â‹®</span>
        <button @click.stop="onDelete(component)">ğŸ—‘ï¸</button>
      </div>
    </div>
    
    <!-- ç©ºçŠ¶æ€ -->
    <div v-if="components.length === 0" class="empty-state">
      <p>ä»å·¦ä¾§æ‹–æ‹½ç»„ä»¶åˆ°è¿™é‡Œå¼€å§‹æ„å»ºé¡µé¢</p>
    </div>
  </div>
</template>

<script setup lang="ts">
import type { ComponentConfig } from '~/types/component-builder'

const props = defineProps<{
  components: ComponentConfig[]
}>()

const emit = defineEmits<{
  (e: 'drop', position: number): void
  (e: 'component-select', component: ComponentConfig): void
  (e: 'component-move', fromIndex: number, toIndex: number): void
  (e: 'component-delete', componentId: string): void
}>()

const selectedId = ref<string | null>(null)
const dragIndex = ref<number | null>(null)
const dropIndex = ref<number | null>(null)

const onSelect = (component: ComponentConfig) => {
  selectedId.value = component.id
  emit('component-select', component)
}

const onDragStart = (component: ComponentConfig, index: number) => {
  dragIndex.value = index
}

const onDragOver = (event: DragEvent, index: number) => {
  dropIndex.value = index
  
  // æ·»åŠ è§†è§‰åé¦ˆ
  if (event.currentTarget) {
    (event.currentTarget as HTMLElement).classList.add('drag-over')
  }
}

const onDrop = (event: DragEvent) => {
  event.preventDefault()
  
  const componentType = event.dataTransfer?.getData('componentType')
  if (componentType) {
    emit('drop', props.components.length)
  }
}

const onDropComponent = (event: DragEvent, index: number) => {
  event.preventDefault()
  
  if (dragIndex.value !== null && dragIndex.value !== index) {
    emit('component-move', dragIndex.value, index)
  }
  
  dragIndex.value = null
  dropIndex.value = null
}

const onDelete = (component: ComponentConfig) => {
  emit('component-delete', component.id)
  if (selectedId.value === component.id) {
    selectedId.value = null
  }
}
</script>
```

#### 3.2.4 å±æ€§ç¼–è¾‘å™¨ç»„ä»¶

```vue
<!-- app/components/admin/PropertyEditor.vue -->
<template>
  <div class="property-editor">
    <h3>ç»„ä»¶å±æ€§</h3>
    
    <div class="property-group">
      <label>ç»„ä»¶åç§°</label>
      <input 
        v-model="localProps.name" 
        type="text"
        placeholder="è¾“å…¥ç»„ä»¶åç§°"
      />
    </div>
    
    <!-- åŠ¨æ€å±æ€§ç¼–è¾‘å™¨ -->
    <div 
      v-for="(property, key) in getPropertySchema(component.type)" 
      :key="key"
      class="property-group"
    >
      <label>{{ property.label }}</label>
      
      <!-- æ–‡æœ¬è¾“å…¥ -->
      <input
        v-if="property.type === 'string'"
        v-model="localProps[key]"
        type="text"
        :placeholder="property.placeholder"
      />
      
      <!-- æ•°å­—è¾“å…¥ -->
      <input
        v-else-if="property.type === 'number'"
        v-model.number="localProps[key]"
        type="number"
        :min="property.min"
        :max="property.max"
      />
      
      <!-- å¸ƒå°”å€¼ï¼ˆå¼€å…³ï¼‰ -->
      <label v-else-if="property.type === 'boolean'" class="switch">
        <input v-model="localProps[key]" type="checkbox" />
        <span class="slider"></span>
      </label>
      
      <!-- ä¸‹æ‹‰é€‰æ‹© -->
      <select
        v-else-if="property.type === 'select'"
        v-model="localProps[key]"
      >
        <option 
          v-for="option in property.options" 
          :key="option.value"
          :value="option.value"
        >
          {{ option.label }}
        </option>
      </select>
      
      <!-- å›¾ç‰‡ä¸Šä¼  -->
      <div v-else-if="property.type === 'image'" class="image-upload">
        <input 
          type="file" 
          accept="image/*"
          @change="onImageUpload($event, key)"
        />
        <img v-if="localProps[key]" :src="localProps[key]" alt="é¢„è§ˆ" />
      </div>
      
      <!-- å¤šè¡Œæ–‡æœ¬ -->
      <textarea
        v-else-if="property.type === 'textarea'"
        v-model="localProps[key]"
        :rows="property.rows || 3"
        :placeholder="property.placeholder"
      />
      
      <!-- é¢œè‰²é€‰æ‹© -->
      <input
        v-else-if="property.type === 'color'"
        v-model="localProps[key]"
        type="color"
      />
      
      <!-- æ•°ç»„ï¼ˆåˆ—è¡¨ï¼‰ -->
      <div v-else-if="property.type === 'array'" class="array-editor">
        <button @click="addArrayItem(key)">+ æ·»åŠ </button>
        <div 
          v-for="(item, index) in localProps[key]" 
          :key="index"
          class="array-item"
        >
          <input 
            v-model="localProps[key][index]" 
            type="text"
          />
          <button @click="removeArrayItem(key, index)">Ã—</button>
        </div>
      </div>
    </div>
    
    <!-- é«˜çº§è®¾ç½® -->
    <div class="advanced-settings">
      <h4>é«˜çº§è®¾ç½®</h4>
      <div class="property-group">
        <label>è‡ªå®šä¹‰ CSS ç±»å</label>
        <input v-model="localProps.customClass" type="text" />
      </div>
      <div class="property-group">
        <label>å†…è”æ ·å¼</label>
        <textarea v-model="localProps.style" rows="4"></textarea>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import type { ComponentConfig, PropertySchema } from '~/types/component-builder'

const props = defineProps<{
  component: ComponentConfig
}>()

const emit = defineEmits<{
  (e: 'update', componentId: string, properties: Record<string, any>): void
}>()

// æœ¬åœ°å±æ€§çŠ¶æ€ï¼ˆåŒå‘ç»‘å®šï¼‰
const localProps = ref<Record<string, any>>({
  ...props.component.props
})

// ç›‘å¬å˜åŒ–ï¼Œå®æ—¶æ›´æ–°
watch(localProps, (newProps) => {
  emit('update', props.component.id, newProps)
}, { deep: true })

// ç»„ä»¶å±æ€§ Schema
const propertySchemas: Record<string, Record<string, PropertySchema>> = {
  'carousel': {
    images: {
      type: 'array',
      label: 'å›¾ç‰‡åˆ—è¡¨',
      placeholder: 'è¾“å…¥å›¾ç‰‡ URL'
    },
    autoplay: {
      type: 'boolean',
      label: 'è‡ªåŠ¨æ’­æ”¾',
      default: true
    },
    interval: {
      type: 'number',
      label: 'æ’­æ”¾é—´éš”ï¼ˆæ¯«ç§’ï¼‰',
      min: 1000,
      max: 10000,
      default: 3000
    },
    showIndicators: {
      type: 'boolean',
      label: 'æ˜¾ç¤ºæŒ‡ç¤ºå™¨',
      default: true
    }
  },
  'product-list': {
    category: {
      type: 'select',
      label: 'å•†å“åˆ†ç±»',
      options: [
        { value: 'all', label: 'å…¨éƒ¨' },
        { value: 'hot', label: 'çƒ­é—¨' },
        { value: 'new', label: 'æ–°å“' },
        { value: 'discount', label: 'æŠ˜æ‰£' }
      ]
    },
    limit: {
      type: 'number',
      label: 'æ˜¾ç¤ºæ•°é‡',
      min: 1,
      max: 20,
      default: 8
    },
    layout: {
      type: 'select',
      label: 'å¸ƒå±€æ–¹å¼',
      options: [
        { value: 'grid', label: 'ç½‘æ ¼' },
        { value: 'list', label: 'åˆ—è¡¨' }
      ]
    },
    showPrice: {
      type: 'boolean',
      label: 'æ˜¾ç¤ºä»·æ ¼',
      default: true
    },
    showDiscount: {
      type: 'boolean',
      label: 'æ˜¾ç¤ºæŠ˜æ‰£',
      default: true
    }
  },
  'banner': {
    image: {
      type: 'image',
      label: 'å¹¿å‘Šå›¾ç‰‡'
    },
    link: {
      type: 'string',
      label: 'è·³è½¬é“¾æ¥',
      placeholder: 'è¾“å…¥é“¾æ¥åœ°å€'
    },
    title: {
      type: 'string',
      label: 'æ ‡é¢˜',
      placeholder: 'è¾“å…¥å¹¿å‘Šæ ‡é¢˜'
    },
    subtitle: {
      type: 'string',
      label: 'å‰¯æ ‡é¢˜',
      placeholder: 'è¾“å…¥å¹¿å‘Šå‰¯æ ‡é¢˜'
    }
  },
  // å…¶ä»–ç»„ä»¶çš„å±æ€§ Schema...
}

const getPropertySchema = (componentType: string): Record<string, PropertySchema> => {
  return propertySchemas[componentType] || {}
}

const onImageUpload = (event: Event, key: string) => {
  const file = (event.target as HTMLInputElement).files?.[0]
  if (file) {
    const reader = new FileReader()
    reader.onload = (e) => {
      localProps.value[key] = e.target?.result as string
    }
    reader.readAsDataURL(file)
  }
}

const addArrayItem = (key: string) => {
  if (!localProps.value[key]) {
    localProps.value[key] = []
  }
  localProps.value[key].push('')
}

const removeArrayItem = (key: string, index: number) => {
  localProps.value[key].splice(index, 1)
}
</script>
```

---

## âš™ï¸ ç»„ä»¶é…ç½®ç³»ç»Ÿ

### 3.1 æ•°æ®æ¨¡å‹è®¾è®¡

```typescript
// app/types/component-builder.ts

/**
 * é¡µé¢é…ç½®
 */
export interface PageConfig {
  id: string
  name: string
  slug: string // é¡µé¢è·¯ç”±
  title: string // SEO æ ‡é¢˜
  description: string // SEO æè¿°
  keywords: string // SEO å…³é”®è¯
  components: ComponentConfig[] // ç»„ä»¶åˆ—è¡¨
  status: 'draft' | 'published' | 'archived' // é¡µé¢çŠ¶æ€
  templateId?: string // æ¨¡æ¿ ID
  createdAt: Date
  updatedAt: Date
  publishedAt?: Date
  authorId: string
}

/**
 * ç»„ä»¶é…ç½®
 */
export interface ComponentConfig {
  id: string // ç»„ä»¶å”¯ä¸€æ ‡è¯†
  type: string // ç»„ä»¶ç±»å‹ï¼ˆcarousel, product-list, etc.ï¼‰
  props: Record<string, any> // ç»„ä»¶å±æ€§
  position: number // ç»„ä»¶ä½ç½®
  style?: Record<string, any> // è‡ªå®šä¹‰æ ·å¼
  customClass?: string // è‡ªå®šä¹‰ CSS ç±»å
  conditions?: ComponentCondition[] // æ˜¾ç¤ºæ¡ä»¶
  animations?: ComponentAnimation[] // åŠ¨ç”»æ•ˆæœ
  createdAt: Date
  updatedAt: Date
}

/**
 * ç»„ä»¶å®šä¹‰ï¼ˆç”¨äºç»„ä»¶åº“ï¼‰
 */
export interface ComponentDefinition {
  type: string
  name: string
  icon: string
  description: string
  category: ComponentCategory
  defaultProps: Record<string, any>
  propertySchema: Record<string, PropertySchema>
  preview: string // é¢„è§ˆå›¾ URL
  tags: string[]
}

/**
 * ç»„ä»¶åˆ†ç±»
 */
export type ComponentCategory = 
  | 'layout' // å¸ƒå±€ç»„ä»¶
  | 'content' // å†…å®¹ç»„ä»¶
  | 'navigation' // å¯¼èˆªç»„ä»¶
  | 'promotion' // ä¿ƒé”€ç»„ä»¶
  | 'product' // å•†å“ç»„ä»¶
  | 'custom' // è‡ªå®šä¹‰ç»„ä»¶

/**
 * å±æ€§ Schemaï¼ˆç”¨äºå±æ€§ç¼–è¾‘å™¨ï¼‰
 */
export interface PropertySchema {
  type: 'string' | 'number' | 'boolean' | 'select' | 'image' | 'textarea' | 'color' | 'array' | 'object'
  label: string
  placeholder?: string
  default?: any
  min?: number
  max?: number
  options?: { value: any; label: string }[]
  rows?: number
  required?: boolean
  validation?: (value: any) => string | null // éªŒè¯å‡½æ•°
}

/**
 * ç»„ä»¶æ˜¾ç¤ºæ¡ä»¶
 */
export interface ComponentCondition {
  type: 'user_role' | 'time_range' | 'device' | 'location' | 'custom'
  value: any
  operator: 'equals' | 'not_equals' | 'greater_than' | 'less_than' | 'contains'
}

/**
 * ç»„ä»¶åŠ¨ç”»æ•ˆæœ
 */
export interface ComponentAnimation {
  type: 'fade' | 'slide' | 'scale' | 'bounce' | 'custom'
  trigger: 'load' | 'scroll' | 'hover' | 'click'
  duration: number
  delay: number
  easing: string
}

/**
 * æ¨¡æ¿é…ç½®
 */
export interface TemplateConfig {
  id: string
  name: string
  description: string
  thumbnail: string
  components: ComponentConfig[]
  category: 'home' | 'sale' | 'product' | 'custom'
  createdAt: Date
  authorId: string
}

/**
 * é¡µé¢ç‰ˆæœ¬
 */
export interface PageVersion {
  id: string
  pageId: string
  config: PageConfig
  version: number
  description: string
  createdAt: Date
}
```

### 3.2 é…ç½®å­˜å‚¨

```typescript
// app/api/modules/page.ts

/**
 * è·å–é¡µé¢é…ç½®
 */
export const getPageConfig = async (slug: string): Promise<PageConfig> => {
  const response = await $fetch<ApiResponse<PageConfig>>(`/api/pages/${slug}`)
  return response.data
}

/**
 * ä¿å­˜é¡µé¢é…ç½®
 */
export const savePageConfig = async (config: PageConfig): Promise<PageConfig> => {
  const response = await $fetch<ApiResponse<PageConfig>>('/api/pages', {
    method: 'POST',
    body: config
  })
  return response.data
}

/**
 * å‘å¸ƒé¡µé¢
 */
export const publishPage = async (pageId: string): Promise<PageConfig> => {
  const response = await $fetch<ApiResponse<PageConfig>>(`/api/pages/${pageId}/publish`, {
    method: 'POST'
  })
  return response.data
}

/**
 * è·å–é¡µé¢ç‰ˆæœ¬å†å²
 */
export const getPageVersions = async (pageId: string): Promise<PageVersion[]> => {
  const response = await $fetch<ApiResponse<PageVersion[]>>(`/api/pages/${pageId}/versions`)
  return response.data
}

/**
 * æ¢å¤é¡µé¢ç‰ˆæœ¬
 */
export const restorePageVersion = async (pageId: string, versionId: string): Promise<PageConfig> => {
  const response = await $fetch<ApiResponse<PageConfig>>(`/api/pages/${pageId}/versions/${versionId}/restore`, {
    method: 'POST'
  })
  return response.data
}
```

---

## ğŸš€ ç»„ä»¶æ¸²æŸ“å¼•æ“

### 4.1 æ ¸å¿ƒæ¸²æŸ“é€»è¾‘

```typescript
// app/composables/useComponentRenderer.ts

import type { ComponentConfig, PageConfig } from '~/types/component-builder'

/**
 * ç»„ä»¶æ¸²æŸ“å¼•æ“
 */
export const useComponentRenderer = () => {
  // ç»„ä»¶æ˜ å°„è¡¨ï¼ˆæ‡’åŠ è½½ï¼‰
  const componentImports: Record<string, () => Promise<{ default: any }>> = {
    'carousel': () => import('~/components/builder/Carousel.vue'),
    'product-list': () => import('~/components/builder/ProductList.vue'),
    'navigation': () => import('~/components/builder/Navigation.vue'),
    'banner': () => import('~/components/builder/Banner.vue'),
    'activity-card': () => import('~/components/builder/ActivityCard.vue'),
    'custom-html': () => import('~/components/builder/CustomHtml.vue'),
    'product-card': () => import('~/components/builder/ProductCard.vue'),
    'tab-nav': () => import('~/components/builder/TabNav.vue'),
    'footer': () => import('~/components/builder/Footer.vue'),
    'product-grid': () => import('~/components/builder/ProductGrid.vue'),
    'category-nav': () => import('~/components/builder/CategoryNav.vue'),
    'price-tag': () => import('~/components/builder/PriceTag.vue'),
    'countdown': () => import('~/components/builder/Countdown.vue'),
    'review-list': () => import('~/components/builder/ReviewList.vue')
  }

  // åŠ¨æ€åŠ è½½ç»„ä»¶
  const loadComponent = async (type: string): Promise<any> => {
    const loader = componentImports[type]
    if (!loader) {
      console.warn(`Component type "${type}" not found`)
      return null
    }
    const module = await loader()
    return module.default
  }

  // æ¸²æŸ“ç»„ä»¶
  const renderComponent = async (component: ComponentConfig) => {
    const Component = await loadComponent(component.type)
    if (!Component) return null

    return {
      Component,
      props: component.props,
      style: component.style,
      customClass: component.customClass
    }
  }

  // æ¸²æŸ“æ‰€æœ‰ç»„ä»¶
  const renderComponents = async (components: ComponentConfig[]) => {
    const renderedComponents = []

    for (const component of components) {
      // æ£€æŸ¥æ˜¾ç¤ºæ¡ä»¶
      if (!await checkConditions(component.conditions)) {
        continue
      }

      const rendered = await renderComponent(component)
      if (rendered) {
        renderedComponents.push({
          ...rendered,
          config: component
        })
      }
    }

    return renderedComponents
  }

  // æ£€æŸ¥æ˜¾ç¤ºæ¡ä»¶
  const checkConditions = async (conditions?: ComponentCondition[]): Promise<boolean> => {
    if (!conditions || conditions.length === 0) return true

    for (const condition of conditions) {
      switch (condition.type) {
        case 'user_role':
          // æ£€æŸ¥ç”¨æˆ·è§’è‰²
          const user = useAuth().user
          if (user && user.role !== condition.value) {
            return false
          }
          break
        case 'time_range':
          // æ£€æŸ¥æ—¶é—´èŒƒå›´
          const now = new Date()
          const startTime = new Date(condition.value.start)
          const endTime = new Date(condition.value.end)
          if (now < startTime || now > endTime) {
            return false
          }
          break
        case 'device':
          // æ£€æŸ¥è®¾å¤‡ç±»å‹
          const device = useDevice().type
          if (device !== condition.value) {
            return false
          }
          break
        case 'location':
          // æ£€æŸ¥åœ°ç†ä½ç½®
          const location = useLocation()
          if (location && location.region !== condition.value) {
            return false
          }
          break
        case 'custom':
          // è‡ªå®šä¹‰æ¡ä»¶
          if (!await condition.value()) {
            return false
          }
          break
      }
    }

    return true
  }

  return {
    loadComponent,
    renderComponent,
    renderComponents,
    checkConditions
  }
}
```

### 4.2 ç»„ä»¶æ¸²æŸ“å™¨ç»„ä»¶

```vue
<!-- app/components/ComponentRenderer.vue -->
<template>
  <div class="component-renderer">
    <div
      v-for="(rendered, index) in renderedComponents"
      :key="rendered.config.id"
      class="rendered-component"
      :class="[rendered.customClass, `component-${rendered.config.type}`]"
      :style="rendered.style"
      :data-component-id="rendered.config.id"
      :data-component-type="rendered.config.type"
    >
      <component 
        :is="rendered.Component" 
        v-bind="rendered.props"
      />
      
      <!-- åŠ¨ç”»æ•ˆæœ -->
      <transition
        v-if="rendered.config.animations"
        :name="getAnimationName(rendered.config.animations[0])"
        :duration="getAnimationDuration(rendered.config.animations[0])"
      >
        <div v-show="true"></div>
      </transition>
    </div>
  </div>
</template>

<script setup lang="ts">
import type { ComponentConfig, ComponentAnimation } from '~/types/component-builder'

const props = defineProps<{
  components: ComponentConfig[]
}>()

const { renderComponents } = useComponentRenderer()

const renderedComponents = ref<Awaited<ReturnType<typeof renderComponents>>>([])

// åˆå§‹åŒ–æ¸²æŸ“
onMounted(async () => {
  renderedComponents.value = await renderComponents(props.components)
})

// ç›‘å¬ç»„ä»¶å˜åŒ–
watch(() => props.components, async (newComponents) => {
  renderedComponents.value = await renderComponents(newComponents)
}, { deep: true })

const getAnimationName = (animation: ComponentAnimation): string => {
  const animationMap: Record<string, string> = {
    'fade': 'fade',
    'slide': 'slide',
    'scale': 'scale',
    'bounce': 'bounce'
  }
  return animationMap[animation.type] || ''
}

const getAnimationDuration = (animation: ComponentAnimation): number => {
  return animation.duration || 300
}
</script>

<style scoped>
/* åŠ¨ç”»æ ·å¼ */
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}

.slide-enter-active,
.slide-leave-active {
  transition: transform 0.3s ease;
}

.slide-enter-from,
.slide-leave-to {
  transform: translateX(-20px);
  opacity: 0;
}

.scale-enter-active,
.scale-leave-active {
  transition: transform 0.3s ease;
}

.scale-enter-from,
.scale-leave-to {
  transform: scale(0.9);
  opacity: 0;
}
</style>
```

---

## ğŸ¯ æ‹–æ‹½äº¤äº’ç³»ç»Ÿ

### 5.1 æ‹–æ‹½å®ç°

```typescript
// app/composables/useDragDrop.ts

/**
 * æ‹–æ‹½äº¤äº’ç³»ç»Ÿ
 */
export const useDragDrop = () => {
  const draggedElement = ref<HTMLElement | null>(null)
  const dragOverElement = ref<HTMLElement | null>(null)
  const isDragging = ref(false)

  // å¼€å§‹æ‹–æ‹½
  const onDragStart = (event: DragEvent, element: HTMLElement, data: any) => {
    if (event.dataTransfer) {
      event.dataTransfer.effectAllowed = 'move'
      event.dataTransfer.setData('application/json', JSON.stringify(data))
    }
    draggedElement.value = element
    isDragging.value = true
    element.classList.add('dragging')
  }

  // æ‹–æ‹½ç»è¿‡
  const onDragOver = (event: DragEvent, element: HTMLElement) => {
    event.preventDefault()
    if (event.dataTransfer) {
      event.dataTransfer.dropEffect = 'move'
    }
    dragOverElement.value = element
    element.classList.add('drag-over')
  }

  // ç¦»å¼€æ‹–æ‹½åŒºåŸŸ
  const onDragLeave = (event: DragEvent, element: HTMLElement) => {
    element.classList.remove('drag-over')
    if (dragOverElement.value === element) {
      dragOverElement.value = null
    }
  }

  // æ”¾ç½®
  const onDrop = (event: DragEvent, element: HTMLElement): any | null => {
    event.preventDefault()
    
    element.classList.remove('drag-over')
    
    if (draggedElement.value) {
      draggedElement.value.classList.remove('dragging')
    }
    
    if (event.dataTransfer) {
      const data = event.dataTransfer.getData('application/json')
      if (data) {
        return JSON.parse(data)
      }
    }
    
    isDragging.value = false
    draggedElement.value = null
    dragOverElement.value = null
    
    return null
  }

  // ç»“æŸæ‹–æ‹½
  const onDragEnd = (event: DragEvent, element: HTMLElement) => {
    element.classList.remove('dragging')
    isDragging.value = false
    draggedElement.value = null
    dragOverElement.value = null
  }

  return {
    draggedElement,
    dragOverElement,
    isDragging,
    onDragStart,
    onDragOver,
    onDragLeave,
    onDrop,
    onDragEnd
  }
}
```

### 5.2 æ‹–æ‹½æ ·å¼

```css
/* app/assets/css/drag-drop.css */

/* æ‹–æ‹½ä¸­çš„å…ƒç´  */
.dragging {
  opacity: 0.5;
  transform: scale(0.95);
  cursor: move;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* æ‹–æ‹½ç»è¿‡çš„å…ƒç´  */
.drag-over {
  border: 2px dashed #4f46e5;
  background-color: rgba(79, 70, 229, 0.05);
  border-radius: 8px;
}

/* ç»„ä»¶åº“ä¸­çš„å¯æ‹–æ‹½é¡¹ */
.component-item {
  cursor: grab;
  transition: all 0.2s ease;
}

.component-item:active {
  cursor: grabbing;
}

.component-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* ç”»å¸ƒä¸­çš„ç»„ä»¶ */
.canvas-component {
  transition: all 0.2s ease;
  cursor: move;
}

.canvas-component:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.canvas-component.selected {
  border: 2px solid #4f46e5;
  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

/* æ‹–æ‹½æ‰‹æŸ„ */
.component-handle {
  position: absolute;
  top: 8px;
  right: 8px;
  display: flex;
  gap: 4px;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.canvas-component:hover .component-handle {
  opacity: 1;
}

.drag-icon {
  cursor: grab;
  padding: 4px 8px;
  background-color: rgba(0, 0, 0, 0.5);
  color: white;
  border-radius: 4px;
  font-size: 12px;
}

.drag-icon:active {
  cursor: grabbing;
}
```

---

## ğŸ› ï¸ ç»„ä»¶å±æ€§ç¼–è¾‘å™¨

### 6.1 å±æ€§ç¼–è¾‘å™¨æ ¸å¿ƒé€»è¾‘

```typescript
// app/composables/usePropertyEditor.ts

import type { ComponentConfig, PropertySchema } from '~/types/component-builder'

/**
 * å±æ€§ç¼–è¾‘å™¨é€»è¾‘
 */
export const usePropertyEditor = (component: Ref<ComponentConfig | null>) => {
  // æœ¬åœ°å±æ€§çŠ¶æ€
  const properties = ref<Record<string, any>>({})

  // ç›‘å¬ç»„ä»¶å˜åŒ–
  watch(component, (newComponent) => {
    if (newComponent) {
      properties.value = { ...newComponent.props }
    } else {
      properties.value = {}
    }
  }, { immediate: true })

  // è·å–å±æ€§ Schema
  const getSchema = (): Record<string, PropertySchema> => {
    if (!component.value) return {}
    return getPropertySchemaForComponent(component.value.type)
  }

  // æ›´æ–°å±æ€§
  const updateProperty = (key: string, value: any) => {
    properties.value[key] = value
    
    // è§¦å‘éªŒè¯
    const schema = getSchema()[key]
    if (schema?.validation) {
      const error = schema.validation(value)
      if (error) {
        console.warn(`Property "${key}" validation error: ${error}`)
      }
    }
  }

  // æ‰¹é‡æ›´æ–°å±æ€§
  const updateProperties = (newProperties: Record<string, any>) => {
    properties.value = { ...properties.value, ...newProperties }
  }

  // é‡ç½®å±æ€§ä¸ºé»˜è®¤å€¼
  const resetToDefault = () => {
    if (!component.value) return
    const schema = getSchema()
    const defaultProps: Record<string, any> = {}
    
    for (const [key, property] of Object.entries(schema)) {
      if (property.default !== undefined) {
        defaultProps[key] = property.default
      }
    }
    
    properties.value = defaultProps
  }

  // éªŒè¯æ‰€æœ‰å±æ€§
  const validate = (): { isValid: boolean; errors: Record<string, string> } => {
    const schema = getSchema()
    const errors: Record<string, string> = {}
    
    for (const [key, property] of Object.entries(schema)) {
      if (property.required && (properties.value[key] === undefined || properties.value[key] === '')) {
        errors[key] = `${property.label} æ˜¯å¿…å¡«é¡¹`
      }
      
      if (property.validation) {
        const error = property.validation(properties.value[key])
        if (error) {
          errors[key] = error
        }
      }
    }
    
    return {
      isValid: Object.keys(errors).length === 0,
      errors
    }
  }

  // è·å–å±æ€§å€¼
  const getProperty = (key: string): any => {
    return properties.value[key]
  }

  return {
    properties,
    getSchema,
    updateProperty,
    updateProperties,
    resetToDefault,
    validate,
    getProperty
  }
}

// ç»„ä»¶å±æ€§ Schema æ˜ å°„
const componentPropertySchemas: Record<string, Record<string, PropertySchema>> = {
  'carousel': {
    images: {
      type: 'array',
      label: 'å›¾ç‰‡åˆ—è¡¨',
      placeholder: 'è¾“å…¥å›¾ç‰‡ URL',
      required: true
    },
    autoplay: {
      type: 'boolean',
      label: 'è‡ªåŠ¨æ’­æ”¾',
      default: true
    },
    interval: {
      type: 'number',
      label: 'æ’­æ”¾é—´éš”ï¼ˆæ¯«ç§’ï¼‰',
      min: 1000,
      max: 10000,
      default: 3000
    },
    showIndicators: {
      type: 'boolean',
      label: 'æ˜¾ç¤ºæŒ‡ç¤ºå™¨',
      default: true
    },
    showArrows: {
      type: 'boolean',
      label: 'æ˜¾ç¤ºç®­å¤´',
      default: true
    }
  },
  'product-list': {
    category: {
      type: 'select',
      label: 'å•†å“åˆ†ç±»',
      options: [
        { value: 'all', label: 'å…¨éƒ¨' },
        { value: 'hot', label: 'çƒ­é—¨' },
        { value: 'new', label: 'æ–°å“' },
        { value: 'discount', label: 'æŠ˜æ‰£' },
        { value: 'recommend', label: 'æ¨è' }
      ],
      default: 'all'
    },
    limit: {
      type: 'number',
      label: 'æ˜¾ç¤ºæ•°é‡',
      min: 1,
      max: 20,
      default: 8,
      validation: (value) => {
        if (value < 1 || value > 20) {
          return 'æ˜¾ç¤ºæ•°é‡å¿…é¡»åœ¨ 1-20 ä¹‹é—´'
        }
        return null
      }
    },
    layout: {
      type: 'select',
      label: 'å¸ƒå±€æ–¹å¼',
      options: [
        { value: 'grid', label: 'ç½‘æ ¼' },
        { value: 'list', label: 'åˆ—è¡¨' },
        { value: 'waterfall', label: 'ç€‘å¸ƒæµ' }
      ],
      default: 'grid'
    },
    showPrice: {
      type: 'boolean',
      label: 'æ˜¾ç¤ºä»·æ ¼',
      default: true
    },
    showDiscount: {
      type: 'boolean',
      label: 'æ˜¾ç¤ºæŠ˜æ‰£',
      default: true
    },
    showAddToCart: {
      type: 'boolean',
      label: 'æ˜¾ç¤ºåŠ å…¥è´­ç‰©è½¦æŒ‰é’®',
      default: true
    }
  },
  'banner': {
    image: {
      type: 'image',
      label: 'å¹¿å‘Šå›¾ç‰‡',
      required: true
    },
    link: {
      type: 'string',
      label: 'è·³è½¬é“¾æ¥',
      placeholder: 'è¾“å…¥é“¾æ¥åœ°å€'
    },
    title: {
      type: 'string',
      label: 'æ ‡é¢˜',
      placeholder: 'è¾“å…¥å¹¿å‘Šæ ‡é¢˜'
    },
    subtitle: {
      type: 'string',
      label: 'å‰¯æ ‡é¢˜',
      placeholder: 'è¾“å…¥å¹¿å‘Šå‰¯æ ‡é¢˜'
    },
    backgroundColor: {
      type: 'color',
      label: 'èƒŒæ™¯é¢œè‰²',
      default: '#ffffff'
    },
    textColor: {
      type: 'color',
      label: 'æ–‡å­—é¢œè‰²',
      default: '#333333'
    }
  },
  'activity-card': {
    title: {
      type: 'string',
      label: 'æ´»åŠ¨æ ‡é¢˜',
      placeholder: 'è¾“å…¥æ´»åŠ¨æ ‡é¢˜',
      required: true
    },
    subtitle: {
      type: 'string',
      label: 'æ´»åŠ¨å‰¯æ ‡é¢˜',
      placeholder: 'è¾“å…¥æ´»åŠ¨å‰¯æ ‡é¢˜'
    },
    image: {
      type: 'image',
      label: 'æ´»åŠ¨å›¾ç‰‡'
    },
    startTime: {
      type: 'string',
      label: 'å¼€å§‹æ—¶é—´',
      placeholder: 'é€‰æ‹©å¼€å§‹æ—¶é—´',
      validation: (value) => {
        if (!value) return null
        const date = new Date(value)
        if (isNaN(date.getTime())) {
          return 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¥æœŸæ—¶é—´'
        }
        return null
      }
    },
    endTime: {
      type: 'string',
      label: 'ç»“æŸæ—¶é—´',
      placeholder: 'é€‰æ‹©ç»“æŸæ—¶é—´'
    },
    buttonText: {
      type: 'string',
      label: 'æŒ‰é’®æ–‡å­—',
      default: 'ç«‹å³å‚ä¸'
    },
    buttonLink: {
      type: 'string',
      label: 'æŒ‰é’®é“¾æ¥',
      placeholder: 'è¾“å…¥æŒ‰é’®è·³è½¬é“¾æ¥'
    },
    buttonColor: {
      type: 'color',
      label: 'æŒ‰é’®é¢œè‰²',
      default: '#4f46e5'
    }
  },
  // å…¶ä»–ç»„ä»¶çš„å±æ€§ Schema...
}

const getPropertySchemaForComponent = (componentType: string): Record<string, PropertySchema> => {
  return componentPropertySchemas[componentType] || {}
}
```

---

## ğŸ’¾ é¡µé¢ä¿å­˜å’Œå‘å¸ƒ

### 7.1 ä¿å­˜å’Œå‘å¸ƒé€»è¾‘

```typescript
// app/composables/usePageManager.ts

import type { PageConfig, PageVersion } from '~/types/component-builder'

/**
 * é¡µé¢ç®¡ç†å™¨
 */
export const usePageManager = () => {
  // å½“å‰é¡µé¢é…ç½®
  const pageConfig = ref<PageConfig | null>(null)

  // å†å²è®°å½•
  const history = ref<PageConfig[]>([])
  const historyIndex = ref(-1)

  // åŠ è½½é¡µé¢
  const loadPage = async (slug: string) => {
    const config = await getPageConfig(slug)
    pageConfig.value = config
    saveToHistory()
  }

  // ä¿å­˜é¡µé¢
  const savePage = async (): Promise<PageConfig> => {
    if (!pageConfig.value) {
      throw new Error('No page config to save')
    }

    const savedConfig = await savePageConfig(pageConfig.value)
    pageConfig.value = savedConfig
    saveToHistory()
    
    return savedConfig
  }

  // å‘å¸ƒé¡µé¢
  const publishPage = async (): Promise<PageConfig> => {
    if (!pageConfig.value) {
      throw new Error('No page config to publish')
    }

    const publishedConfig = await publishPage(pageConfig.value.id)
    pageConfig.value = publishedConfig
    
    return publishedConfig
  }

  // ä¿å­˜åˆ°å†å²è®°å½•
  const saveToHistory = () => {
    if (!pageConfig.value) return

    const configCopy = JSON.parse(JSON.stringify(pageConfig.value))
    
    // åˆ é™¤å½“å‰ä½ç½®ä¹‹åçš„å†å²
    history.value = history.value.slice(0, historyIndex.value + 1)
    
    // æ·»åŠ æ–°çš„å†å²è®°å½•
    history.value.push(configCopy)
    
    // é™åˆ¶å†å²è®°å½•æ•°é‡
    if (history.value.length > 50) {
      history.value.shift()
    } else {
      historyIndex.value++
    }
  }

  // æ’¤é”€
  const undo = () => {
    if (historyIndex.value > 0) {
      historyIndex.value--
      pageConfig.value = JSON.parse(JSON.stringify(history.value[historyIndex.value]))
    }
  }

  // é‡åš
  const redo = () => {
    if (historyIndex.value < history.value.length - 1) {
      historyIndex.value++
      pageConfig.value = JSON.parse(JSON.stringify(history.value[historyIndex.value]))
    }
  }

  // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ’¤é”€
  const canUndo = computed(() => historyIndex.value > 0)

  // æ£€æŸ¥æ˜¯å¦å¯ä»¥é‡åš
  const canRedo = computed(() => historyIndex.value < history.value.length - 1)

  // åˆ›å»ºæ–°é¡µé¢
  const createPage = async (name: string, slug: string): Promise<PageConfig> => {
    const newConfig: PageConfig = {
      id: `page-${Date.now()}`,
      name,
      slug,
      title: name,
      description: '',
      keywords: '',
      components: [],
      status: 'draft',
      createdAt: new Date(),
      updatedAt: new Date(),
      authorId: useAuth().user?.id || 'anonymous'
    }

    const savedConfig = await savePageConfig(newConfig)
    pageConfig.value = savedConfig
    saveToHistory()
    
    return savedConfig
  }

  // å¤åˆ¶é¡µé¢
  const duplicatePage = async (pageId: string, newName: string, newSlug: string): Promise<PageConfig> => {
    const originalConfig = await getPageConfigById(pageId)
    
    const newConfig: PageConfig = {
      ...originalConfig,
      id: `page-${Date.now()}`,
      name: newName,
      slug: newSlug,
      status: 'draft',
      createdAt: new Date(),
      updatedAt: new Date(),
      publishedAt: undefined,
      components: originalConfig.components.map(c => ({
        ...c,
        id: `component-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`
      }))
    }

    const savedConfig = await savePageConfig(newConfig)
    return savedConfig
  }

  // è·å–é¡µé¢ç‰ˆæœ¬å†å²
  const getVersions = async (pageId: string): Promise<PageVersion[]> => {
    return await getPageVersions(pageId)
  }

  // æ¢å¤ç‰ˆæœ¬
  const restoreVersion = async (pageId: string, versionId: string): Promise<PageConfig> => {
    const restoredConfig = await restorePageVersion(pageId, versionId)
    pageConfig.value = restoredConfig
    saveToHistory()
    
    return restoredConfig
  }

  return {
    pageConfig,
    history,
    historyIndex,
    canUndo,
    canRedo,
    loadPage,
    savePage,
    publishPage,
    undo,
    redo,
    createPage,
    duplicatePage,
    getVersions,
    restoreVersion
  }
}
```

### 7.2 å·¥å…·æ ç»„ä»¶

```vue
<!-- app/components/admin/Toolbar.vue -->
<template>
  <div class="toolbar">
    <div class="toolbar-left">
      <h2>{{ pageConfig.name || 'é¡µé¢ç¼–è¾‘å™¨' }}</h2>
      <span v-if="pageConfig.status === 'draft'" class="status-badge draft">è‰ç¨¿</span>
      <span v-else-if="pageConfig.status === 'published'" class="status-badge published">å·²å‘å¸ƒ</span>
    </div>
    
    <div class="toolbar-center">
      <button 
        class="toolbar-btn" 
        @click="$emit('undo')"
        :disabled="!canUndo"
        title="æ’¤é”€"
      >
        â†¶ æ’¤é”€
      </button>
      <button 
        class="toolbar-btn" 
        @click="$emit('redo')"
        :disabled="!canRedo"
        title="é‡åš"
      >
        â†· é‡åš
      </button>
      <button 
        class="toolbar-btn" 
        @click="$emit('preview')"
        title="é¢„è§ˆ"
      >
        ğŸ‘ï¸ é¢„è§ˆ
      </button>
      <button 
        class="toolbar-btn" 
        @click="$emit('template-save')"
        title="ä¿å­˜ä¸ºæ¨¡æ¿"
      >
        ğŸ’¾ ä¿å­˜ä¸ºæ¨¡æ¿
      </button>
    </div>
    
    <div class="toolbar-right">
      <button 
        class="toolbar-btn secondary" 
        @click="$emit('save')"
      >
        ğŸ’¾ ä¿å­˜
      </button>
      <button 
        class="toolbar-btn primary" 
        @click="$emit('publish')"
        :disabled="pageConfig.status === 'published'"
      >
        ğŸš€ {{ pageConfig.status === 'published' ? 'å·²å‘å¸ƒ' : 'å‘å¸ƒ' }}
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import type { PageConfig } from '~/types/component-builder'

defineProps<{
  pageConfig: PageConfig
  canUndo: boolean
  canRedo: boolean
}>()

defineEmits<{
  (e: 'save'): void
  (e: 'publish'): void
  (e: 'undo'): void
  (e: 'redo'): void
  (e: 'preview'): void
  (e: 'template-save'): void
}>()
</script>

<style scoped>
.toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 24px;
  background-color: #ffffff;
  border-bottom: 1px solid #e5e7eb;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.toolbar-left h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
}

.status-badge {
  display: inline-block;
  padding: 2px 8px;
  margin-left: 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
}

.status-badge.draft {
  background-color: #fef3c7;
  color: #d97706;
}

.status-badge.published {
  background-color: #d1fae5;
  color: #065f46;
}

.toolbar-btn {
  padding: 8px 16px;
  margin-left: 8px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  background-color: #ffffff;
  color: #374151;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.toolbar-btn:hover:not(:disabled) {
  background-color: #f9fafb;
  border-color: #9ca3af;
}

.toolbar-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.toolbar-btn.primary {
  background-color: #4f46e5;
  border-color: #4f46e5;
  color: #ffffff;
}

.toolbar-btn.primary:hover:not(:disabled) {
  background-color: #4338ca;
  border-color: #4338ca;
}

.toolbar-btn.secondary {
  background-color: #f3f4f6;
  border-color: #e5e7eb;
}
</style>
```

---

## ğŸ“¦ ç»„ä»¶åº“è®¾è®¡

### 8.1 ç»„ä»¶åº“æ ¸å¿ƒç»„ä»¶

```vue
<!-- app/components/builder/Carousel.vue -->
<template>
  <div class="carousel" :style="containerStyle">
    <div 
      class="carousel-track" 
      :style="trackStyle"
      ref="trackRef"
    >
      <div
        v-for="(image, index) in images"
        :key="index"
        class="carousel-slide"
        :style="slideStyle"
      >
        <img :src="image.src" :alt="image.alt || `Slide ${index + 1}`" />
        <div v-if="image.title" class="slide-title">{{ image.title }}</div>
        <div v-if="image.description" class="slide-description">{{ image.description }}</div>
      </div>
    </div>
    
    <!-- ç®­å¤´ -->
    <button 
      v-if="showArrows"
      class="carousel-arrow prev"
      @click="prevSlide"
    >
      â—€
    </button>
    <button 
      v-if="showArrows"
      class="carousel-arrow next"
      @click="nextSlide"
    >
      â–¶
    </button>
    
    <!-- æŒ‡ç¤ºå™¨ -->
    <div v-if