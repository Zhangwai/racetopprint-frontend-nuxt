// æ´»åŠ¨åˆ—è¡¨ APIï¼ˆGET /api/salesï¼‰

export default defineEventHandler(async (event) => {
  // è·å–æŸ¥è¯¢å‚æ•°
  const query = getQuery(event)
  console.log('ğŸ“‹ æ¥æ”¶åˆ°çš„æŸ¥è¯¢å‚æ•°:', query)
  
  const page = parseInt(query.page as string) || 1
  const pageSize = parseInt(query.pageSize as string) || 10
  const status = (query.status as string) || ""
  
  console.log(`ğŸ“„ åˆ†é¡µå‚æ•°: page=${page}, pageSize=${pageSize}`)

  // Mock æ•°æ®ï¼ˆ12 æ¡æ•°æ®ï¼Œæ¯é¡µ 3 æ¡ï¼Œå…± 4 é¡µï¼‰
  const sales = [
    {
      id: 1,
      slug: "new-year-sale",
      title: "æ–°å¹´ç‰¹æƒ ",
      description: "æ–°å¹´å¤§ä¿ƒé”€ï¼Œå…¨åœºå°åˆ·äº§å“8æŠ˜ä¼˜æƒ ï¼Œæœºä¸å¯å¤±ï¼",
      type: "èŠ‚æ—¥ä¿ƒé”€",
      startDate: "2024-01-01",
      endDate: "2024-01-15",
      discountPrice: 88,
      originalPrice: 110,
      discount: 20,
      status: "active",
      products: [1, 2, 3],
      image: "/images/sale-new-year.jpg",
      isFeatured: true,
      createdAt: "2023-12-20T00:00:00Z",
      updatedAt: "2024-01-01T12:00:00Z",
    },
    {
      id: 2,
      slug: "spring-sale",
      title: "æ˜¥å­£æ–°å“",
      description: "æ˜¥å­£æ–°å“å‘å¸ƒï¼Œå®šåˆ¶åŒ…è£…è®¾è®¡75æŠ˜ï¼Œä¸“ä¸šè®¾è®¡å¸ˆä¸ºæ‚¨æœåŠ¡ï¼",
      type: "æ–°å“ä¸Šå¸‚",
      startDate: "2024-02-01",
      endDate: "2024-02-28",
      discountPrice: 225,
      originalPrice: 300,
      discount: 25,
      status: "upcoming",
      products: [4, 6],
      image: "/images/sale-spring.jpg",
      isFeatured: true,
      createdAt: "2024-01-10T00:00:00Z",
      updatedAt: "2024-01-15T12:00:00Z",
    },
    {
      id: 3,
      slug: "anniversary-sale",
      title: "å‘¨å¹´åº†å…¸",
      description: "å…¬å¸å‘¨å¹´åº†ï¼Œä¹¦ç±è£…è®¢ä¹°äºŒé€ä¸€ï¼Œé™é‡ä¼˜æƒ ï¼",
      type: "é™æ—¶æŠ˜æ‰£",
      startDate: "2023-12-01",
      endDate: "2023-12-31",
      discountPrice: 200,
      originalPrice: 285,
      discount: 30,
      status: "ended",
      products: [5],
      image: "/images/sale-anniversary.jpg",
      isFeatured: false,
      createdAt: "2023-11-20T00:00:00Z",
      updatedAt: "2023-12-01T12:00:00Z",
    },
    {
      id: 4,
      slug: "black-friday",
      title: "é»‘è‰²æ˜ŸæœŸäº”",
      description: "é»‘è‰²æ˜ŸæœŸäº”ç‰¹æƒ ï¼Œå…¨åœº5æŠ˜èµ·ï¼Œå¹´åº¦æœ€å¤§ä¼˜æƒ ï¼",
      type: "å¹´åº¦å¤§ä¿ƒ",
      startDate: "2023-11-24",
      endDate: "2023-11-27",
      discountPrice: 50,
      originalPrice: 100,
      discount: 50,
      status: "ended",
      products: [1, 2, 3, 4, 5, 6],
      image: "/images/sale-blackfriday.jpg",
      isFeatured: false,
      createdAt: "2023-11-20T00:00:00Z",
      updatedAt: "2023-11-24T12:00:00Z",
    },
    {
      id: 5,
      slug: "summer-sale",
      title: "å¤æ—¥æ¸…å‡‰",
      description: "å¤æ—¥ä¿ƒé”€å­£ï¼Œå®£ä¼ å•é¡µå°åˆ·6æŠ˜ä¼˜æƒ ï¼",
      type: "å­£èŠ‚ä¿ƒé”€",
      startDate: "2024-06-01",
      endDate: "2024-06-30",
      discountPrice: 66,
      originalPrice: 110,
      discount: 40,
      status: "upcoming",
      products: [2, 4],
      image: "/images/sale-summer.jpg",
      isFeatured: true,
      createdAt: "2024-05-15T00:00:00Z",
      updatedAt: "2024-05-20T12:00:00Z",
    },
    {
      id: 6,
      slug: "back-to-school",
      title: "å¼€å­¦å­£",
      description: "å¼€å­¦å­£ç‰¹æƒ ï¼Œå­¦ç”Ÿæ‰‹å†Œã€ç¬”è®°æœ¬å°åˆ·7æŠ˜ï¼",
      type: "èŠ‚æ—¥ä¿ƒé”€",
      startDate: "2024-08-15",
      endDate: "2024-09-15",
      discountPrice: 77,
      originalPrice: 110,
      discount: 30,
      status: "upcoming",
      products: [3, 5],
      image: "/images/sale-school.jpg",
      isFeatured: false,
      createdAt: "2024-07-20T00:00:00Z",
      updatedAt: "2024-07-25T12:00:00Z",
    },
    {
      id: 7,
      slug: "mid-year-sale",
      title: "å¹´ä¸­ç‰¹æƒ ",
      description: "å¹´ä¸­æ¸…ä»“å¤§ä¿ƒé”€ï¼Œå…¨åœºå°åˆ·äº§å“5æŠ˜èµ·ï¼",
      type: "é™æ—¶æŠ˜æ‰£",
      startDate: "2024-06-18",
      endDate: "2024-06-28",
      discountPrice: 55,
      originalPrice: 110,
      discount: 50,
      status: "active",
      products: [1, 2, 3, 4, 5, 6],
      image: "/images/sale-midyear.jpg",
      isFeatured: true,
      createdAt: "2024-06-01T00:00:00Z",
      updatedAt: "2024-06-10T12:00:00Z",
    },
    {
      id: 8,
      slug: "double-11",
      title: "åŒ11ç‹‚æ¬¢",
      description: "åŒåä¸€è´­ç‰©èŠ‚ï¼Œå…¨åœºå°åˆ·äº§å“4æŠ˜ä¼˜æƒ ï¼",
      type: "å¹´åº¦å¤§ä¿ƒ",
      startDate: "2024-11-11",
      endDate: "2024-11-13",
      discountPrice: 44,
      originalPrice: 110,
      discount: 60,
      status: "upcoming",
      products: [1, 2, 3, 4, 5, 6],
      image: "/images/sale-double11.jpg",
      isFeatured: true,
      createdAt: "2024-10-01T00:00:00Z",
      updatedAt: "2024-10-15T12:00:00Z",
    },
    {
      id: 9,
      slug: "christmas-sale",
      title: "åœ£è¯ç‰¹æƒ ",
      description: "åœ£è¯èŠ‚ä¿ƒé”€ï¼Œè´ºå¡ã€ç¤¼å“åŒ…è£…å°åˆ·75æŠ˜ï¼",
      type: "èŠ‚æ—¥ä¿ƒé”€",
      startDate: "2024-12-20",
      endDate: "2024-12-25",
      discountPrice: 82,
      originalPrice: 110,
      discount: 25,
      status: "upcoming",
      products: [1, 3],
      image: "/images/sale-christmas.jpg",
      isFeatured: false,
      createdAt: "2024-11-20T00:00:00Z",
      updatedAt: "2024-11-25T12:00:00Z",
    },
    {
      id: 10,
      slug: "year-end-sale",
      title: "å¹´ç»ˆå¤§ä¿ƒ",
      description: "å¹´ç»ˆæœ€åä¸€æ³¢ä¼˜æƒ ï¼Œå…¨åœºå°åˆ·äº§å“6æŠ˜ï¼",
      type: "é™æ—¶æŠ˜æ‰£",
      startDate: "2024-12-28",
      endDate: "2024-12-31",
      discountPrice: 66,
      originalPrice: 110,
      discount: 40,
      status: "upcoming",
      products: [2, 4, 6],
      image: "/images/sale-yearend.jpg",
      isFeatured: true,
      createdAt: "2024-12-01T00:00:00Z",
      updatedAt: "2024-12-10T12:00:00Z",
    },
    {
      id: 11,
      slug: "vip-sale",
      title: "VIPä¸“äº«",
      description: "VIPä¼šå‘˜ä¸“äº«ä¼˜æƒ ï¼Œæ‰€æœ‰äº§å“é¢å¤–9æŠ˜ï¼",
      type: "ä¼šå‘˜ä¸“äº«",
      startDate: "2024-01-01",
      endDate: "2024-12-31",
      discountPrice: 99,
      originalPrice: 110,
      discount: 10,
      status: "active",
      products: [1, 2, 3, 4, 5, 6],
      image: "/images/sale-vip.jpg",
      isFeatured: false,
      createdAt: "2023-12-01T00:00:00Z",
      updatedAt: "2024-01-01T12:00:00Z",
    },
    {
      id: 12,
      slug: "new-customer-sale",
      title: "æ–°å®¢æœ‰ç¤¼",
      description: "æ–°å®¢æˆ·é¦–å•ç«‹å‡50å…ƒï¼Œä¸é™äº§å“ï¼",
      type: "æ–°å®¢ä¼˜æƒ ",
      startDate: "2024-01-01",
      endDate: "2024-12-31",
      discountPrice: 68,
      originalPrice: 110,
      discount: 38,
      status: "active",
      products: [1, 2, 3, 4, 5, 6],
      image: "/images/sale-newcustomer.jpg",
      isFeatured: false,
      createdAt: "2023-12-15T00:00:00Z",
      updatedAt: "2024-01-05T12:00:00Z",
    },
  ]

  // è¿‡æ»¤æ•°æ®
  let filteredSales = sales

  if (status) {
    filteredSales = filteredSales.filter((s) => s.status === status)
  }

  // åˆ†é¡µ
  const startIndex = (page - 1) * pageSize
  const endIndex = startIndex + pageSize
  const paginatedSales = filteredSales.slice(startIndex, endIndex)

  // æ¨¡æ‹Ÿå»¶è¿Ÿ
  await new Promise((resolve) => setTimeout(resolve, 100))

  // è¿”å›å“åº”
  return {
    code: 200,
    message: "success",
    data: {
      list: paginatedSales,
      pagination: {
        page,
        pageSize,
        total: filteredSales.length,
        totalPages: Math.ceil(filteredSales.length / pageSize),
      },
    },
  }
})
